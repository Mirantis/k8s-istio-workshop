<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Instal Rook | Istio Workshop</title>
    <meta name="description" content="Istio workshop running on OpenStack">
    <link rel="icon" href="/k8s-istio-workshop/favicon.ico">
    <meta property="article:modified_time" content="2019-03-07T10:38:36.000Z"><meta property="og:site_name" content="Istio Workshop"><meta property="og:title" content="Instal Rook"><meta property="og:type" content="website"><meta property="og:url" content="/lab-04/"><meta name="twitter:title" content="Instal Rook"><meta name="twitter:url" content="/lab-04/"><meta name="twitter:card" content="summary_large_image">
    <link rel="preload" href="/k8s-istio-workshop/assets/css/0.styles.2dcdd8f4.css" as="style"><link rel="preload" href="/k8s-istio-workshop/assets/js/app.c242fc30.js" as="script"><link rel="preload" href="/k8s-istio-workshop/assets/js/2.93ef1c11.js" as="script"><link rel="preload" href="/k8s-istio-workshop/assets/js/13.32857c17.js" as="script"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/10.b47dd514.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/11.f507860f.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/12.860113ac.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/14.1d353182.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/15.85b664cc.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/16.01747397.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/17.8731e2f4.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/18.65b244ff.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/3.b91652f2.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/4.4b811129.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/5.3afcd348.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/6.79416558.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/7.ecfd21e8.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/8.0b72bd57.js"><link rel="prefetch" href="/k8s-istio-workshop/assets/js/9.92913571.js">
    <link rel="stylesheet" href="/k8s-istio-workshop/assets/css/0.styles.2dcdd8f4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/k8s-istio-workshop/" class="home-link router-link-active"><img src="/k8s-istio-workshop/istio.svg" alt="Istio Workshop" class="logo"> <span class="site-name can-hide">Istio Workshop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/k8s-istio-workshop/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Istio links</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://istio.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://istio.io/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio docs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/mirantis/k8s-istio-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio workshop
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/ruzickap/k8s-istio-demo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio demo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/mirantis/k8s-istio-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/k8s-istio-workshop/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Istio links</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://istio.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://istio.io/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio docs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/mirantis/k8s-istio-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio workshop
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/ruzickap/k8s-istio-demo" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Istio demo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/mirantis/k8s-istio-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/k8s-istio-workshop/" class="sidebar-link">Istio workshop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/#objectives" class="sidebar-link">Objectives</a></li><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/#workshop" class="sidebar-link">Workshop</a></li><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/#list-of-guis-used-in-workshop" class="sidebar-link">List of GUIs used in Workshop</a></li><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/#links" class="sidebar-link">Links</a></li></ul></li><li><a href="/k8s-istio-workshop/lab-01/" class="sidebar-link">Create VMs in OpenStack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/lab-01/#prepare-the-local-working-environment-inside-docker" class="sidebar-link">Prepare the local working environment inside Docker</a></li><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/lab-01/#provision-vms-in-openstack" class="sidebar-link">Provision VMs in OpenStack</a></li></ul></li><li><a href="/k8s-istio-workshop/lab-02/" class="sidebar-link">Install Kubernetes to the VMs</a></li><li><a href="/k8s-istio-workshop/lab-03/" class="sidebar-link">Install Helm</a></li><li><a href="/k8s-istio-workshop/lab-04/" class="active sidebar-link">Instal Rook</a></li><li><a href="/k8s-istio-workshop/lab-05/" class="sidebar-link">Install ElasticSearch and Kibana</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/lab-05/#install-fluentbit" class="sidebar-link">Install FluentBit</a></li></ul></li><li><a href="/k8s-istio-workshop/lab-06/" class="sidebar-link">Istio - Installation</a></li><li><a href="/k8s-istio-workshop/lab-07/" class="sidebar-link">Istio - Bookinfo Application</a></li><li><a href="/k8s-istio-workshop/lab-08/" class="sidebar-link">Istio - Configuring Request Routing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/lab-08/#apply-a-virtual-service" class="sidebar-link">Apply a virtual service</a></li><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/lab-08/#route-based-on-user-identity" class="sidebar-link">Route based on user identity</a></li></ul></li><li><a href="/k8s-istio-workshop/lab-09/" class="sidebar-link">Istio - Injecting an HTTP delay fault</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-istio-workshop/lab-09/#injecting-an-http-abort-fault" class="sidebar-link">Injecting an HTTP abort fault</a></li></ul></li><li><a href="/k8s-istio-workshop/lab-10/" class="sidebar-link">Istio - Weight-based routing</a></li><li><a href="/k8s-istio-workshop/lab-11/" class="sidebar-link">Istio - Mirroring</a></li><li><a href="/k8s-istio-workshop/lab-12/" class="sidebar-link">Istio - Cleanup</a></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="instal-rook"><a href="#instal-rook" aria-hidden="true" class="header-anchor">#</a> Instal Rook</h1> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Screencast: <a href="https://asciinema.org/a/229605?autoplay=0&amp;t=155" target="_blank" rel="noopener noreferrer">https://asciinema.org/a/229605?t=155<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <p>Install <a href="https://rook.io/" target="_blank" rel="noopener noreferrer">Rook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Operator
(<a href="https://ceph.com/" target="_blank" rel="noopener noreferrer">Ceph<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> storage for k8s):</p> <div class="language-bash extra-class"><pre class="language-bash"><code>helm repo add rook-stable https://charts.rook.io/stable
helm <span class="token function">install</span> --wait --name rook-ceph --namespace rook-ceph-system rook-stable/rook-ceph
<span class="token function">sleep</span> 40
</code></pre></div><p>See how the rook-ceph-system should look like:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get svc,deploy,po --namespace<span class="token operator">=</span>rook-ceph-system -o wide
</code></pre></div><p>Output:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS           IMAGES             SELECTOR
deployment.extensions/rook-ceph-operator   1/1     1            1           3m36s   rook-ceph-operator   rook/ceph:v0.9.2   app<span class="token operator">=</span>rook-ceph-operator

NAME                                      READY   STATUS    RESTARTS   AGE     IP               NODE                             NOMINATED NODE   READINESS GATES
pod/rook-ceph-agent-2bxhq                 1/1     Running   0          2m14s   192.168.250.12   pruzicka-k8s-istio-workshop-node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-agent-8h4p4                 1/1     Running   0          2m14s   192.168.250.11   pruzicka-k8s-istio-workshop-node01   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-agent-mq69r                 1/1     Running   0          2m14s   192.168.250.13   pruzicka-k8s-istio-workshop-node03   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-operator-7478c899b5-px2hc   1/1     Running   0          3m37s   10.244.2.3       pruzicka-k8s-istio-workshop-node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-discover-8ffj8                   1/1     Running   0          2m14s   10.244.2.4       pruzicka-k8s-istio-workshop-node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-discover-l56jj                   1/1     Running   0          2m14s   10.244.1.2       pruzicka-k8s-istio-workshop-node03   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-discover-q9xwp                   1/1     Running   0          2m14s   10.244.0.4       pruzicka-k8s-istio-workshop-node01   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Create your Rook cluster:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl create -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/cluster.yaml
</code></pre></div><p>Get the <a href="https://rook.io/docs/rook/master/ceph-toolbox.html" target="_blank" rel="noopener noreferrer">Toolbox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> with ceph commands:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl create -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/toolbox.yaml
<span class="token function">sleep</span> 240
</code></pre></div><p>Check what was created in <code>rook-ceph</code> namespace:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get svc,deploy,po --namespace<span class="token operator">=</span>rook-ceph -o wide
</code></pre></div><p>Output:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>NAME                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE     SELECTOR
service/rook-ceph-mgr             ClusterIP   10.103.36.128   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        9283/TCP   8m45s   app<span class="token operator">=</span>rook-ceph-mgr,rook_cluster<span class="token operator">=</span>rook-ceph
service/rook-ceph-mgr-dashboard   ClusterIP   10.99.173.58    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        8443/TCP   8m45s   app<span class="token operator">=</span>rook-ceph-mgr,rook_cluster<span class="token operator">=</span>rook-ceph
service/rook-ceph-mon-a           ClusterIP   10.102.39.160   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        6790/TCP   12m     app<span class="token operator">=</span>rook-ceph-mon,ceph_daemon_id<span class="token operator">=</span>a,mon<span class="token operator">=</span>a,mon_cluster<span class="token operator">=</span>rook-ceph,rook_cluster<span class="token operator">=</span>rook-ceph
service/rook-ceph-mon-b           ClusterIP   10.102.49.137   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        6790/TCP   11m     app<span class="token operator">=</span>rook-ceph-mon,ceph_daemon_id<span class="token operator">=</span>b,mon<span class="token operator">=</span>b,mon_cluster<span class="token operator">=</span>rook-ceph,rook_cluster<span class="token operator">=</span>rook-ceph
service/rook-ceph-mon-c           ClusterIP   10.96.25.143    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        6790/TCP   10m     app<span class="token operator">=</span>rook-ceph-mon,ceph_daemon_id<span class="token operator">=</span>c,mon<span class="token operator">=</span>c,mon_cluster<span class="token operator">=</span>rook-ceph,rook_cluster<span class="token operator">=</span>rook-ceph

NAME                                    READY   UP-TO-DATE   AVAILABLE   AGE     CONTAINERS        IMAGES             SELECTOR
deployment.extensions/rook-ceph-mgr-a   1/1     1            1           9m33s   mgr               ceph/ceph:v13      app<span class="token operator">=</span>rook-ceph-mgr,ceph_daemon_id<span class="token operator">=</span>a,instance<span class="token operator">=</span>a,mgr<span class="token operator">=</span>a,rook_cluster<span class="token operator">=</span>rook-ceph
deployment.extensions/rook-ceph-mon-a   1/1     1            1           12m     mon               ceph/ceph:v13      app<span class="token operator">=</span>rook-ceph-mon,ceph_daemon_id<span class="token operator">=</span>a,mon<span class="token operator">=</span>a,mon_cluster<span class="token operator">=</span>rook-ceph,rook_cluster<span class="token operator">=</span>rook-ceph
deployment.extensions/rook-ceph-mon-b   1/1     1            1           11m     mon               ceph/ceph:v13      app<span class="token operator">=</span>rook-ceph-mon,ceph_daemon_id<span class="token operator">=</span>b,mon<span class="token operator">=</span>b,mon_cluster<span class="token operator">=</span>rook-ceph,rook_cluster<span class="token operator">=</span>rook-ceph
deployment.extensions/rook-ceph-mon-c   1/1     1            1           10m     mon               ceph/ceph:v13      app<span class="token operator">=</span>rook-ceph-mon,ceph_daemon_id<span class="token operator">=</span>c,mon<span class="token operator">=</span>c,mon_cluster<span class="token operator">=</span>rook-ceph,rook_cluster<span class="token operator">=</span>rook-ceph
deployment.extensions/rook-ceph-osd-0   1/1     1            1           8m34s   osd               ceph/ceph:v13      app<span class="token operator">=</span>rook-ceph-osd,ceph-osd-id<span class="token operator">=</span>0,rook_cluster<span class="token operator">=</span>rook-ceph
deployment.extensions/rook-ceph-osd-1   1/1     1            1           8m33s   osd               ceph/ceph:v13      app<span class="token operator">=</span>rook-ceph-osd,ceph-osd-id<span class="token operator">=</span>1,rook_cluster<span class="token operator">=</span>rook-ceph
deployment.extensions/rook-ceph-osd-2   1/1     1            1           8m33s   osd               ceph/ceph:v13      app<span class="token operator">=</span>rook-ceph-osd,ceph-osd-id<span class="token operator">=</span>2,rook_cluster<span class="token operator">=</span>rook-ceph
deployment.extensions/rook-ceph-tools   1/1     1            1           12m     rook-ceph-tools   rook/ceph:master   app<span class="token operator">=</span>rook-ceph-tools

NAME                                                             READY   STATUS      RESTARTS   AGE     IP               NODE                             NOMINATED NODE   READINESS GATES
pod/rook-ceph-mgr-a-669f5b47fc-sjvrr                             1/1     Running     0          9m33s   10.244.1.6       pruzicka-k8s-istio-workshop-node03   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-mon-a-784f8fb5b6-zcvjr                             1/1     Running     0          12m     10.244.0.5       pruzicka-k8s-istio-workshop-node01   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-mon-b-6dfbf486f4-2ktpm                             1/1     Running     0          11m     10.244.2.5       pruzicka-k8s-istio-workshop-node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-mon-c-6c85f6f44-j5wwv                              1/1     Running     0          10m     10.244.1.5       pruzicka-k8s-istio-workshop-node03   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-osd-0-6dd9cdc946-7th52                             1/1     Running     0          8m34s   10.244.1.8       pruzicka-k8s-istio-workshop-node03   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-osd-1-64cdd77897-9vdrh                             1/1     Running     0          8m33s   10.244.2.7       pruzicka-k8s-istio-workshop-node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-osd-2-67fcc446bd-skq52                             1/1     Running     0          8m33s   10.244.0.7       pruzicka-k8s-istio-workshop-node01   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-osd-prepare-pruzicka-k8s-istio-workshop-node01-z29hj   0/2     Completed   0          8m39s   10.244.0.6       pruzicka-k8s-istio-workshop-node01   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-osd-prepare-pruzicka-k8s-istio-workshop-node02-q8xqx   0/2     Completed   0          8m39s   10.244.2.6       pruzicka-k8s-istio-workshop-node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-osd-prepare-pruzicka-k8s-istio-workshop-node03-vbwxv   0/2     Completed   0          8m39s   10.244.1.7       pruzicka-k8s-istio-workshop-node03   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
pod/rook-ceph-tools-76c7d559b6-s6s4l                             1/1     Running     0          12m     192.168.250.12   pruzicka-k8s-istio-workshop-node02   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Create a storage class based on the Ceph RBD volume plugin:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl create -f https://raw.githubusercontent.com/rook/rook/master/cluster/examples/kubernetes/ceph/storageclass.yaml
<span class="token function">sleep</span> 5
</code></pre></div><p>Set <code>rook-ceph-block</code> as default Storage Class:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl patch storageclass rook-ceph-block -p <span class="token string">&quot;{\&quot;metadata\&quot;: {\&quot;annotations\&quot;:{\&quot;storageclass.kubernetes.io/is-default-class\&quot;:\&quot;true\&quot;}}}&quot;</span>
</code></pre></div><p>Check the Storage Classes:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl describe storageclass
</code></pre></div><p>Output:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>Name:                  rook-ceph-block
IsDefaultClass:        Yes
Annotations:           storageclass.kubernetes.io/is-default-class<span class="token operator">=</span>true
Provisioner:           ceph.rook.io/block
Parameters:            blockPool<span class="token operator">=</span>replicapool,clusterNamespace<span class="token operator">=</span>rook-ceph,fstype<span class="token operator">=</span>xfs
AllowVolumeExpansion:  <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>
MountOptions:          <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
ReclaimPolicy:         Delete
VolumeBindingMode:     Immediate
Events:                <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>See the CephBlockPool:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl describe cephblockpool --namespace<span class="token operator">=</span>rook-ceph
</code></pre></div><p>Output:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>Name:         replicapool
Namespace:    rook-ceph
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
API Version:  ceph.rook.io/v1
Kind:         CephBlockPool
Metadata:
  Creation Timestamp:  2019-02-04T09:51:55Z
  Generation:          1
  Resource Version:    3171
  Self Link:           /apis/ceph.rook.io/v1/namespaces/rook-ceph/cephblockpools/replicapool
  UID:                 8163367d-2862-11e9-a470-fa163e90237a
Spec:
  Replicated:
    Size:  1
Events:    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div><p>Check the status of your Ceph installation:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl -n rook-ceph <span class="token function">exec</span> <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get pod -l <span class="token string">&quot;app=rook-ceph-tools&quot;</span> -o jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable">)</span></span> -- ceph status
</code></pre></div><p>Output:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>  cluster:
    id:     1f4458a6-f574-4e6c-8a25-5a5eef6eb0a7
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum c,a,b
    mgr: a<span class="token punctuation">(</span>active<span class="token punctuation">)</span>
    osd: 3 osds: 3 up, 3 <span class="token keyword">in</span>

  data:
    pools:   1 pools, 100 pgs
    objects: 0  objects, 0 B
    usage:   13 GiB used, 44 GiB / 58 GiB avail
    pgs:     100 active+clean
</code></pre></div><p>Ceph status:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl -n rook-ceph <span class="token function">exec</span> <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get pod -l <span class="token string">&quot;app=rook-ceph-tools&quot;</span> -o jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable">)</span></span> -- ceph osd status
</code></pre></div><p>Output:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>+----+--------------------------------+-------+-------+--------+---------+--------+---------+-----------+
<span class="token operator">|</span> <span class="token function">id</span> <span class="token operator">|</span>              host              <span class="token operator">|</span>  used <span class="token operator">|</span> avail <span class="token operator">|</span> wr ops <span class="token operator">|</span> wr data <span class="token operator">|</span> rd ops <span class="token operator">|</span> rd data <span class="token operator">|</span>   state   <span class="token operator">|</span>
+----+--------------------------------+-------+-------+--------+---------+--------+---------+-----------+
<span class="token operator">|</span> 0  <span class="token operator">|</span> pruzicka-k8s-istio-workshop-node03 <span class="token operator">|</span> 4302M <span class="token operator">|</span> 15.0G <span class="token operator">|</span>    0   <span class="token operator">|</span>     0   <span class="token operator">|</span>    0   <span class="token operator">|</span>     0   <span class="token operator">|</span> exists,up <span class="token operator">|</span>
<span class="token operator">|</span> 1  <span class="token operator">|</span> pruzicka-k8s-istio-workshop-node02 <span class="token operator">|</span> 4455M <span class="token operator">|</span> 14.8G <span class="token operator">|</span>    0   <span class="token operator">|</span>     0   <span class="token operator">|</span>    0   <span class="token operator">|</span>     0   <span class="token operator">|</span> exists,up <span class="token operator">|</span>
<span class="token operator">|</span> 2  <span class="token operator">|</span> pruzicka-k8s-istio-workshop-node01 <span class="token operator">|</span> 4948M <span class="token operator">|</span> 14.3G <span class="token operator">|</span>    0   <span class="token operator">|</span>     0   <span class="token operator">|</span>    0   <span class="token operator">|</span>     0   <span class="token operator">|</span> exists,up <span class="token operator">|</span>
+----+--------------------------------+-------+-------+--------+---------+--------+---------+-----------+
</code></pre></div><p>Check the cluster usage status:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl -n rook-ceph <span class="token function">exec</span> <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get pod -l <span class="token string">&quot;app=rook-ceph-tools&quot;</span> -o jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable">)</span></span> -- ceph <span class="token function">df</span>
</code></pre></div><p>Output:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>GLOBAL:
    SIZE       AVAIL      RAW USED     %RAW USED
    58 GiB     44 GiB       13 GiB         23.22
POOLS:
    NAME            ID     USED     %USED     MAX AVAIL     OBJECTS
    replicapool     1       0 B         0        40 GiB           0
</code></pre></div><p>Change listening port of <a href="http://docs.ceph.com/docs/mimic/mgr/dashboard/" target="_blank" rel="noopener noreferrer">Ceph Dashboard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
(<a href="https://github.com/rook/rook/issues/2526" target="_blank" rel="noopener noreferrer">https://github.com/rook/rook/issues/2526<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>):</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl -n rook-ceph <span class="token function">exec</span> -it <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get pod -l <span class="token string">&quot;app=rook-ceph-tools&quot;</span> -o jsonpath<span class="token operator">=</span><span class="token string">'{.items[0].metadata.name}'</span><span class="token variable">)</span></span> -- ceph config <span class="token keyword">set</span> mgr mgr/dashboard/server_addr 0.0.0.0
<span class="token function">sleep</span> 5
kubectl delete pod -n rook-ceph  <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get pod -l app<span class="token operator">=</span>rook-ceph-mgr -o jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable">)</span></span>
<span class="token function">sleep</span> 5
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>Run the following command on your local environment to allow your browser reach
the pods ports.</p></div> <p>Configure port forwarding to Ceph Dashboard:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl -n rook-ceph port-forward <span class="token variable"><span class="token variable">$(</span>kubectl -n rook-ceph get pod -l app<span class="token operator">=</span>rook-ceph-mgr -o jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable">)</span></span> 8443:8443 <span class="token operator">&amp;</span>
</code></pre></div><p>To access the Ceph Dashboard <a href="https://localhost:8443" target="_blank" rel="noopener noreferrer">https://localhost:8443<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
use username <code>admin</code> and password can be found by running:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o yaml <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;password:&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&quot;{print \<span class="token variable">$2</span>}&quot;</span> <span class="token operator">|</span> base64 --decode
</code></pre></div><p>Ceph Dashboard (<a href="https://localhost:8443" target="_blank" rel="noopener noreferrer">https://localhost:8443<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>):</p> <p><img src="/k8s-istio-workshop/assets/img/ceph_dashboard.d29f4d99.png" alt="Ceph Dashboard" title="Ceph Dashboard"></p> <p><img src="https://raw.githubusercontent.com/rook/artwork/05c1bd90005958e14bbba14f983c884b1d474879/logo/Rook_Logo(Color).svg?sanitize=true" alt="Rook" title="Rook"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mirantis/k8s-istio-workshop/edit/master/docs/lab-04/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/7/2019, 10:38:36 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/k8s-istio-workshop/lab-03/" class="prev">
          Install Helm
        </a></span> <span class="next"><a href="/k8s-istio-workshop/lab-05/">
          Install ElasticSearch and Kibana
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/k8s-istio-workshop/assets/js/app.c242fc30.js" defer></script><script src="/k8s-istio-workshop/assets/js/2.93ef1c11.js" defer></script><script src="/k8s-istio-workshop/assets/js/13.32857c17.js" defer></script>
  </body>
</html>
